<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>
    <%= title %>
  </title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

  <%- include("partials/head") %>
    <link rel="stylesheet" href="/css/vehiculo.css">
</head>

<script>
  $(document).ready(function () {
    $('.select2-clientes').select2({
      theme: "classic",
      width: "100%",
      placeholder: "Buscar cliente...",
      allowClear: true
    });
  });
</script>


<body class="bg-overlay">

  <%- include("partials/navigation") %>

    <div class="bg-overlay">

      <div
        class="container d-flex justify-content-center align-items-start pt-5 pb-5 animate__animated animate__bounceIn">
        <div class="card animated flipInY form-card shadow-sm">
          <div class="card animated flipInY form-card shadow-sm">

            <div class="card-header bg-dark text-white text-center border-secondary">
              <h3 class="mb-0">
                <%= title %>
              </h3>
            </div>

            <div class="card-body">

              <% if (error) { %>
                <div class="alert alert-danger text-center">
                  <%= error %>
                </div>
                <% } %>

                  <form
                    action="<%= vehiculo.id_vehiculo ? '/vehiculo/editar/' + vehiculo.id_vehiculo : '/vehiculo/agregar' %>"
                    method="POST" autocomplete="off">

                    <div class="mb-3">
                      <label for="matricula" class="form-label">Matrícula:</label>
                      <input id="matricula" name="matricula" type="text"
                        class="form-control bg-dark text-white border-secondary" placeholder="P123-456"
                        value="<%= (datos && datos.matricula) || vehiculo.matricula || '' %>" required>
                    </div>

                    <div class="mb-3">
                      <label for="marca" class="form-label">Marca:</label>
                      <input id="marca" name="marca" type="text"
                        class="form-control bg-dark text-white border-secondary" placeholder="Toyota, Nissan..."
                        value="<%= (datos && datos.marca) || vehiculo.marca || '' %>" required>
                    </div>

                    <div class="mb-3">
                      <label for="modelo" class="form-label">Modelo:</label>
                      <input id="modelo" name="modelo" type="text"
                        class="form-control bg-dark text-white border-secondary" placeholder="Corolla 2018, Hilux, etc."
                        value="<%= (datos && datos.modelo) || vehiculo.modelo || '' %>" required>
                    </div>

                    <div class="mb-3">
                      <label for="color" class="form-label">Color:</label>
                      <input id="color" name="color" type="text"
                        class="form-control bg-dark text-white border-secondary"
                        value="<%= (datos && datos.color) || vehiculo.color || '' %>" required>
                    </div>

                    <div class="mb-3">
                      <label for="id_cliente" class="form-label">Cliente:</label>
                      <% const selectedCliente=(datos && datos.id_cliente) || vehiculo.id_cliente; %>
                        <select id="id_cliente" name="id_cliente"
                          class="form-control bg-dark text-white border-secondary select2-clientes" required>
                          <option value="">-- Seleccione un cliente --</option>
                          <% if (clientes && clientes.length> 0) { %>
                            <% clientes.forEach(c=> { %>
                              <option value="<%= c.id_cliente %>" <%=selectedCliente==c.id_cliente ? 'selected' : '' %>
                                >
                                <%= c.nombre %> (<%= c.dui %>)
                              </option>
                              <% }) %>
                                <% } %>
                        </select>

                    </div>

                    <div class="mb-3">
                      <label for="id_tipo_vehiculo" class="form-label">Tipo de vehículo:</label>

                      <div class="d-flex gap-2">
                        <% const selectedTipo=(datos && datos.id_tipo_vehiculo) || vehiculo.id_tipo_vehiculo; %>

                          <select id="id_tipo_vehiculo" name="id_tipo_vehiculo"
                            class="form-control bg-dark text-white border-secondary" required>
                            <option value="">-- Seleccione tipo de vehículo --</option>
                            <% if (tiposVehiculo && tiposVehiculo.length> 0) { %>
                              <% tiposVehiculo.forEach(t=> { %>
                                <option value="<%= t.id_tipo_vehiculo %>" <%=selectedTipo==t.id_tipo_vehiculo
                                  ? 'selected' : '' %>>
                                  <%= t.nombre %> ($<%= t.tarifa_hora %>/h)
                                </option>
                                <% }) %>
                                  <% } %>
                          </select>

                          <a href="/tipos-vehiculo?redirect=/vehiculos" class="btn btn-outline-success">
                            + Nuevo
                          </a>
                      </div>
                    </div>

                    <div class="d-grid gap-2 mt-3">
                      <button type="submit" class="btn btn-primary">Guardar</button>
                      <a href="/vehiculos/lista" class="btn btn-outline-secondary">Ir a lista</a>
                    </div>

                  </form>

            </div>
          </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
          crossorigin="anonymous"></script>

</body>

</html>